#!/usr/bin/env python2


import rospy

from std_msgs.msg import String
import sys, select, os
if os.name == 'nt':
  import msvcrt
else:
  import tty, termios

def getKey():
    if os.name == 'nt':
      if sys.version_info[0] >= 3:
        return msvcrt.getch().decode()
      else:
        return msvcrt.getch()

    tty.setraw(sys.stdin.fileno())
    rlist, _, _ = select.select([sys.stdin], [], [], 0.1)
    if rlist:
        key = sys.stdin.read(1)
    else:
        key = ''

    termios.tcsetattr(sys.stdin, termios.TCSADRAIN, settings)
    return key

if __name__=="__main__":
	if os.name != 'nt':
	  settings = termios.tcgetattr(sys.stdin)

	rospy.init_node('turtlebot_multiplex')

	pubcmd = rospy.Publisher('cmd_local', String, queue_size=10)
	pubweb = rospy.Publisher('cmd_web', String, queue_size=10)

	turtlebot3_model = rospy.get_param("model", "burger")
	 
	try:
		while(1):
			key = getKey()
			if key == 'z' or key == 'x' or key == 'q' or key == 'd' or key == 's':
				pubcmd.publish(key)
			elif( key == '8' or key == '4' or key == '6' or key == '2' or key == '5'):
				pubweb.publish(key)
			else:
				if (key == '\x03'):
			 		break

	finally:
		key = getKey()
		pubcmd.publish(key)
		pubweb.publish(key)


	if os.name != 'nt':
		termios.tcsetattr(sys.stdin, termios.TCSADRAIN, settings)
